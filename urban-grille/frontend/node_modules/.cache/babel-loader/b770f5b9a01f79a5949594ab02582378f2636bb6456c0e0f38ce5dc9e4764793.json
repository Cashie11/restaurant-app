{"ast":null,"code":"import axios from'axios';const api=axios.create({baseURL:'http://localhost:8000/api',headers:{'Content-Type':'application/json'}});// Add token to requests\napi.interceptors.request.use(config=>{const token=localStorage.getItem('access_token');if(token){config.headers.Authorization=\"Bearer \".concat(token);}return config;},error=>Promise.reject(error));// Handle token refresh on 401\napi.interceptors.response.use(response=>response,async error=>{var _error$response;const originalRequest=error.config;// Prevent infinite loops\nif(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===401&&!originalRequest._retry){originalRequest._retry=true;try{const refreshToken=localStorage.getItem('refresh_token');if(!refreshToken){throw new Error('No refresh token');}// Call refresh endpoint\n// Note: We use a new axios instance to avoid interceptors loop\nconst response=await axios.post('http://localhost:8000/api/auth/refresh-token',null,{params:{refresh_token:refreshToken}});const{access_token,refresh_token:new_refresh_token}=response.data;localStorage.setItem('access_token',access_token);localStorage.setItem('refresh_token',new_refresh_token);// Update header and retry original request\noriginalRequest.headers.Authorization=\"Bearer \".concat(access_token);return api(originalRequest);}catch(refreshError){// If refresh fails, logout user\nlocalStorage.removeItem('access_token');localStorage.removeItem('refresh_token');window.location.href='/signin';return Promise.reject(refreshError);}}return Promise.reject(error);});export default api;","map":{"version":3,"names":["axios","api","create","baseURL","headers","interceptors","request","use","config","token","localStorage","getItem","Authorization","concat","error","Promise","reject","response","_error$response","originalRequest","status","_retry","refreshToken","Error","post","params","refresh_token","access_token","new_refresh_token","data","setItem","refreshError","removeItem","window","location","href"],"sources":["/home/cyber/Desktop/Bot/team1/urban-grille/frontend/src/api/axios.ts"],"sourcesContent":["import axios from 'axios';\n\nconst api = axios.create({\n    baseURL: 'http://localhost:8000/api',\n    headers: {\n        'Content-Type': 'application/json',\n    },\n});\n\n// Add token to requests\napi.interceptors.request.use(\n    (config) => {\n        const token = localStorage.getItem('access_token');\n        if (token) {\n            config.headers.Authorization = `Bearer ${token}`;\n        }\n        return config;\n    },\n    (error) => Promise.reject(error)\n);\n\n// Handle token refresh on 401\napi.interceptors.response.use(\n    (response) => response,\n    async (error) => {\n        const originalRequest = error.config;\n\n        // Prevent infinite loops\n        if (error.response?.status === 401 && !originalRequest._retry) {\n            originalRequest._retry = true;\n\n            try {\n                const refreshToken = localStorage.getItem('refresh_token');\n                if (!refreshToken) {\n                    throw new Error('No refresh token');\n                }\n\n                // Call refresh endpoint\n                // Note: We use a new axios instance to avoid interceptors loop\n                const response = await axios.post('http://localhost:8000/api/auth/refresh-token', null, {\n                    params: { refresh_token: refreshToken }\n                });\n\n                const { access_token, refresh_token: new_refresh_token } = response.data;\n\n                localStorage.setItem('access_token', access_token);\n                localStorage.setItem('refresh_token', new_refresh_token);\n\n                // Update header and retry original request\n                originalRequest.headers.Authorization = `Bearer ${access_token}`;\n                return api(originalRequest);\n            } catch (refreshError) {\n                // If refresh fails, logout user\n                localStorage.removeItem('access_token');\n                localStorage.removeItem('refresh_token');\n                window.location.href = '/signin';\n                return Promise.reject(refreshError);\n            }\n        }\n        return Promise.reject(error);\n    }\n);\n\nexport default api;\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,KAAM,OAAO,CAEzB,KAAM,CAAAC,GAAG,CAAGD,KAAK,CAACE,MAAM,CAAC,CACrBC,OAAO,CAAE,2BAA2B,CACpCC,OAAO,CAAE,CACL,cAAc,CAAE,kBACpB,CACJ,CAAC,CAAC,CAEF;AACAH,GAAG,CAACI,YAAY,CAACC,OAAO,CAACC,GAAG,CACvBC,MAAM,EAAK,CACR,KAAM,CAAAC,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC,CAClD,GAAIF,KAAK,CAAE,CACPD,MAAM,CAACJ,OAAO,CAACQ,aAAa,WAAAC,MAAA,CAAaJ,KAAK,CAAE,CACpD,CACA,MAAO,CAAAD,MAAM,CACjB,CAAC,CACAM,KAAK,EAAKC,OAAO,CAACC,MAAM,CAACF,KAAK,CACnC,CAAC,CAED;AACAb,GAAG,CAACI,YAAY,CAACY,QAAQ,CAACV,GAAG,CACxBU,QAAQ,EAAKA,QAAQ,CACtB,KAAO,CAAAH,KAAK,EAAK,KAAAI,eAAA,CACb,KAAM,CAAAC,eAAe,CAAGL,KAAK,CAACN,MAAM,CAEpC;AACA,GAAI,EAAAU,eAAA,CAAAJ,KAAK,CAACG,QAAQ,UAAAC,eAAA,iBAAdA,eAAA,CAAgBE,MAAM,IAAK,GAAG,EAAI,CAACD,eAAe,CAACE,MAAM,CAAE,CAC3DF,eAAe,CAACE,MAAM,CAAG,IAAI,CAE7B,GAAI,CACA,KAAM,CAAAC,YAAY,CAAGZ,YAAY,CAACC,OAAO,CAAC,eAAe,CAAC,CAC1D,GAAI,CAACW,YAAY,CAAE,CACf,KAAM,IAAI,CAAAC,KAAK,CAAC,kBAAkB,CAAC,CACvC,CAEA;AACA;AACA,KAAM,CAAAN,QAAQ,CAAG,KAAM,CAAAjB,KAAK,CAACwB,IAAI,CAAC,8CAA8C,CAAE,IAAI,CAAE,CACpFC,MAAM,CAAE,CAAEC,aAAa,CAAEJ,YAAa,CAC1C,CAAC,CAAC,CAEF,KAAM,CAAEK,YAAY,CAAED,aAAa,CAAEE,iBAAkB,CAAC,CAAGX,QAAQ,CAACY,IAAI,CAExEnB,YAAY,CAACoB,OAAO,CAAC,cAAc,CAAEH,YAAY,CAAC,CAClDjB,YAAY,CAACoB,OAAO,CAAC,eAAe,CAAEF,iBAAiB,CAAC,CAExD;AACAT,eAAe,CAACf,OAAO,CAACQ,aAAa,WAAAC,MAAA,CAAac,YAAY,CAAE,CAChE,MAAO,CAAA1B,GAAG,CAACkB,eAAe,CAAC,CAC/B,CAAE,MAAOY,YAAY,CAAE,CACnB;AACArB,YAAY,CAACsB,UAAU,CAAC,cAAc,CAAC,CACvCtB,YAAY,CAACsB,UAAU,CAAC,eAAe,CAAC,CACxCC,MAAM,CAACC,QAAQ,CAACC,IAAI,CAAG,SAAS,CAChC,MAAO,CAAApB,OAAO,CAACC,MAAM,CAACe,YAAY,CAAC,CACvC,CACJ,CACA,MAAO,CAAAhB,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC,CAChC,CACJ,CAAC,CAED,cAAe,CAAAb,GAAG","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}